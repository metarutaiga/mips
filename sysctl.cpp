//==============================================================================
// MIPS(R) Architecture For Programmers Volume II-A: The MIPS64(R) Instruction Set Reference Manual
//
// Document Number: MD00087
// Revision 6.06
// December 15, 2016
//
// Copyright (C) Wave Computing, Inc. All rights reserved.
//==============================================================================

#include "cpu.h"
#include "sysctl.h"

//------------------------------------------------------------------------------
#define o &SYSCTL::
#define x , o
//------------------------------------------------------------------------------
// Table A.14 MIPS64 COP0 Encoding of rs Field
//------------------------------------------------------------------------------
const SYSCTL::FINSTRUCTION SYSCTL::tableRS[4 * 8] =
{
    o MFC0  x DMFC0 x ____      x ____  x MTC0  x DMTC0 x ____      x ____
    x ____  x ____  x RDPGPR    x MFMC0 x ____  x ____  x WRPGPR    x ____
    x C0    x C0    x C0        x C0    x C0    x C0    x C0        x C0
    x C0    x C0    x C0        x C0    x C0    x C0    x C0        x C0
};
//------------------------------------------------------------------------------
// Table A.15 MIPS64 COP0 Encoding of Function Field When rs=C0
//------------------------------------------------------------------------------
const SYSCTL::FINSTRUCTION SYSCTL::tableC0[8 * 8] =
{
    o ____  x TLBR  x TLBWI x TLBINV    x TLBINVF   x ____  x TLBWR x ____
    x TLBP  x ____  x ____  x ____      x ____      x ____  x ____  x ____
    x ____  x ____  x ____  x ____      x ____      x ____  x ____  x ____
    x ERET  x ____  x ____  x ____      x ____      x ____  x ____  x DERET
    x WAIT  x ____  x ____  x ____      x ____      x ____  x ____  x ____
    x ____  x ____  x ____  x ____      x ____      x ____  x ____  x ____
    x ____  x ____  x ____  x ____      x ____      x ____  x ____  x ____
    x ____  x ____  x ____  x ____      x ____      x ____  x ____  x ____
};
//------------------------------------------------------------------------------
#undef o
#undef x
//------------------------------------------------------------------------------
SYSCTL::SYSCTL(CPU& cpu_) : COP(cpu_)
{
}
//------------------------------------------------------------------------------
SYSCTL::~SYSCTL()
{
}
//------------------------------------------------------------------------------
void SYSCTL::Execute(unsigned int encode)
{
    Encode = encode;

    FINSTRUCTION RS = tableRS[rs];
    (this->*RS)();
}
//------------------------------------------------------------------------------
void SYSCTL::LDC(unsigned int encode)
{
    Encode = encode;

    LL();
}
//------------------------------------------------------------------------------
void SYSCTL::LWC(unsigned int encode)
{
    Encode = encode;
}
//------------------------------------------------------------------------------
void SYSCTL::SDC(unsigned int encode)
{
    Encode = encode;

    SC();
}
//------------------------------------------------------------------------------
void SYSCTL::SWC(unsigned int encode)
{
    Encode = encode;
}
//------------------------------------------------------------------------------
void SYSCTL::LL()
{
    intptr_t address = cpu.GPR[rs] + immediate;
    if (address & 3)
    {
        cpu.SignalException(CPU::AddressErrorLoad);
    }
    else
    {
        int load = *(int*)address;
        cpu.GPR[rt] = load;
    }
}
//------------------------------------------------------------------------------
void SYSCTL::SC()
{
    intptr_t address = cpu.GPR[rs] + immediate;
    if (address & 3)
    {
        cpu.SignalException(CPU::AddressErrorStore);
    }
    else
    {
        int& store = *(int*)address;
        store = (int)cpu.GPR[rt];
    }
}
//------------------------------------------------------------------------------
// Table A.14 MIPS64 COP0 Encoding of rs Field
//------------------------------------------------------------------------------
void SYSCTL::MFC0()
{
}
//------------------------------------------------------------------------------
void SYSCTL::DMFC0()
{
}
//------------------------------------------------------------------------------
void SYSCTL::MTC0()
{
}
//------------------------------------------------------------------------------
void SYSCTL::DMTC0()
{
}
//------------------------------------------------------------------------------
void SYSCTL::RDPGPR()
{
}
//------------------------------------------------------------------------------
void SYSCTL::MFMC0()
{
}
//------------------------------------------------------------------------------
void SYSCTL::WRPGPR()
{
}
//------------------------------------------------------------------------------
void SYSCTL::C0()
{
    FINSTRUCTION C0 = tableC0[rs];
    (this->*C0)();
}
//------------------------------------------------------------------------------
// Table A.15 MIPS64 COP0 Encoding of Function Field When rs=C0
//------------------------------------------------------------------------------
void SYSCTL::TLBR()
{
}
//------------------------------------------------------------------------------
void SYSCTL::TLBWI()
{
}
//------------------------------------------------------------------------------
void SYSCTL::TLBINV()
{
}
//------------------------------------------------------------------------------
void SYSCTL::TLBINVF()
{
}
//------------------------------------------------------------------------------
void SYSCTL::TLBWR()
{
}
//------------------------------------------------------------------------------
void SYSCTL::TLBP()
{
}
//------------------------------------------------------------------------------
void SYSCTL::ERET()
{
}
//------------------------------------------------------------------------------
void SYSCTL::DERET()
{
}
//------------------------------------------------------------------------------
void SYSCTL::WAIT()
{
}
//------------------------------------------------------------------------------
